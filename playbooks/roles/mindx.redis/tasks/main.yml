- name: create yaml directory
  file:
    path: "{{ REDIS_YAML_DIR }}"
    state: directory
    mode: 0750

- name: create redis.yaml
  template:
    src: "{{ item }}"
    dest: "{{ REDIS_YAML_DIR }}/{{ item }}"
    mode: 0640
  with_items:
    - redis.yaml

- name: deploy redis
  shell: kubectl apply -f {{ REDIS_YAML_DIR }}/{{ item }}
  environment:
    http_proxy: ""
    https_proxy: ""
    HTTP_PROXY: ""
    HTTPS_PROXY: ""
  with_items:
    - redis.yaml
